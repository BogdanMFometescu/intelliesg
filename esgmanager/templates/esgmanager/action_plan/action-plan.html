{% extends 'base.html' %}
{% load static %}
{% block content %}
   <br>
   <br>
   <br>
   <section class="section-header bg-secondary text-white">
       <div class="container">
           <div class="row justify-content-between align-items-center">
               <div class="col-12 col-md-7 col-lg-6 text-center text-md-left">
                   <h1 class="display-2 mb-4">ESG Action Plan</h1>
                   <p class="lead mb-4 text-muted">
                       In the quest for sustainability, understanding and managing the carbon footprint of fuel consumption is paramount.
                   </p>
                   <a href="" class="btn btn-tertiary me-3 animate-up-2">What we do <span class="ms-2">
                           <span class="fas fa-arrow-right"></span></span></a>
               </div>
               <div class="col-12 col-md-5 d-none d-md-block text-center">
                   <img src="{% static 'images/path_to_image.png' %}" alt="">
               </div>
           </div>
       </div>
   </section>

   <!-- Detail View for ESG Action Plans by Pillar -->
   <div class="container mt-4">
       <p>Company: {{ company.name }}</p>

       {% for pillar in company.esgpillars_set.all %}
       <h3>{{ pillar.pillar }}</h3>
       <p>{{ pillar.description }}</p>

       <!-- Table for Objectives and Actions of the current Pillar -->
       <table class="table table-hover">
           <thead>
               <tr>
                   <th scope="col">Objective</th>
                   <th scope="col">Description</th>
                   <th scope="col">Actions</th>
                   <th scope="col">Responsible</th>
                   <th scope="col">Start</th>
                   <th scope="col">End</th>
                   <th scope="col">Status</th>
                   <th scope="col">Completion %</th>
               </tr>
           </thead>
           <tbody>
               {% for objective in pillar.esgactionplanobjectives_set.all %}
               <tr>
                   <td rowspan="{{ objective.esgactionplanactions_set.all|length }}">{{ objective.objective }}</td>
                   <td rowspan="{{ objective.esgactionplanactions_set.all|length }}">{{ objective.description }}</td>
                   {% for action in objective.esgactionplanactions_set.all %}
                   <!-- Create new row for each action detail -->
                   {% if forloop.first %}
                   <td>{{ action.action }}</td>
                   <td>{{ action.responsible }}</td>
                   <td>{{ action.start_date|date:"Y-m-d" }}</td>
                   <td>{{ action.end_date|date:"Y-m-d" }}</td>
                   <td>{{ action.status }}</td>
                   <td>{{ action.completion }}%</td>
                   </tr>
                   {% else %}
                   <tr>
                       <td>{{ action.action }}</td>
                       <td>{{ action.responsible }}</td>
                       <td>{{ action.start_date|date:"Y-m-d" }}</td>
                       <td>{{ action.end_date|date:"Y-m-d" }}</td>
                       <td>{{ action.status }}</td>
                       <td>{{ action.completion }}%</td>
                   </tr>
                   {% endif %}
                   {% endfor %}
               {% endfor %}
           </tbody>
       </table>
       {% endfor %}
   </div>

{% endblock content %}
